<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½æ–‡ä»¶ç¿»è¯‘æœåŠ¡</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes loading {
            0% { opacity: 0.2; }
            50% { opacity: 1; }
            100% { opacity: 0.2; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- Hero Section -->
        <div class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white">
            <div class="container mx-auto px-4 py-16">
                <div class="text-center">
                    <h1 class="text-4xl md:text-5xl font-bold mb-4">æ™ºèƒ½æ–‡ä»¶ç¿»è¯‘æœåŠ¡</h1>
                    <p class="text-xl md:text-2xl text-blue-100 mb-8">å¿«é€Ÿã€å‡†ç¡®çš„å¤šè¯­è¨€æ–‡æ¡£ç¿»è¯‘è§£å†³æ–¹æ¡ˆ</p>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="container mx-auto px-4 py-8">
            <!-- Features Grid -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <div class="text-blue-600 text-3xl mb-4">ğŸ“„</div>
                    <h3 class="text-xl font-semibold mb-2">å¤šæ ¼å¼æ”¯æŒ</h3>
                    <p class="text-gray-600">æ”¯æŒ PDFã€HTMLã€Markdownã€EPUB ç­‰å¤šç§æ–‡æ¡£æ ¼å¼</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <div class="text-blue-600 text-3xl mb-4">ğŸš€</div>
                    <h3 class="text-xl font-semibold mb-2">å¿«é€Ÿå¤„ç†</h3>
                    <p class="text-gray-600">é‡‡ç”¨å…ˆè¿›çš„AIæ¨¡å‹ï¼Œå¿«é€Ÿå®Œæˆç¿»è¯‘ä»»åŠ¡</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <div class="text-blue-600 text-3xl mb-4">ğŸ¯</div>
                    <h3 class="text-xl font-semibold mb-2">ç²¾å‡†ç¿»è¯‘</h3>
                    <p class="text-gray-600">ä¿æŒåŸæ–‡æ ¼å¼ï¼Œç¡®ä¿ç¿»è¯‘å‡†ç¡®æ€§</p>
                </div>
            </div>

            <!-- Upload Form -->
            <div class="max-w-2xl mx-auto">
                <div class="bg-white p-8 rounded-lg shadow-md">
                    <form id="uploadForm" class="space-y-6" enctype="multipart/form-data">
                        <div>
                            <label for="file" class="block text-sm font-medium text-gray-700 mb-2">
                                é€‰æ‹©æ–‡ä»¶ (æ”¯æŒ PDF, HTML, Markdown, EPUB)
                            </label>
                            <input type="file" id="file" name="file" 
                                accept=".pdf,.html,.md,.epub" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="output_format" class="block text-sm font-medium text-gray-700 mb-2">è¾“å‡ºæ ¼å¼</label>
                                <select id="output_format" name="output_format" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="same">ä¿æŒåŸæ ¼å¼</option>
                                    <option value="markdown">è½¬æ¢ä¸ºMarkdown</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">å¤„ç†é€‰é¡¹</label>
                                <div class="flex items-center space-x-4">
                                    <label class="inline-flex items-center">
                                        <input type="checkbox" id="need_translate" name="need_translate" 
                                            class="form-checkbox h-4 w-4 text-blue-600" checked
                                            onchange="toggleTranslateOptions()">
                                        <span class="ml-2">éœ€è¦ç¿»è¯‘</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div id="translate_options" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="source_lang" class="block text-sm font-medium text-gray-700 mb-2">æºè¯­è¨€</label>
                                <select id="source_lang" name="source_lang"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="en">è‹±è¯­</option>
                                    <option value="zh">ç®€ä½“ä¸­æ–‡</option>
                                </select>
                            </div>
                            
                            <div>
                                <label for="target_lang" class="block text-sm font-medium text-gray-700 mb-2">ç›®æ ‡è¯­è¨€</label>
                                <select id="target_lang" name="target_lang"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="zh">ç®€ä½“ä¸­æ–‡</option>
                                    <option value="en">è‹±è¯­</option>
                                </select>
                            </div>

                            <div>
                                <label for="model" class="block text-sm font-medium text-gray-700 mb-2">é€‰æ‹©æ¨¡å‹</label>
                                <select id="model" name="model"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    {% if models %}
                                        {% for model in models %}
                                        <option value="{{ model }}">{{ model }}</option>
                                        {% endfor %}
                                    {% else %}
                                        <option value="">æœªæ‰¾åˆ°å¯ç”¨æ¨¡å‹</option>
                                    {% endif %}
                                </select>
                                <div class="mt-2 text-sm text-gray-500">
                                    å¯ç”¨æ¨¡å‹: {{ models|length }} ä¸ª
                                </div>
                            </div>
                        </div>

                        <script>
                            function toggleTranslateOptions() {
                                const needTranslate = document.getElementById('need_translate').checked;
                                const translateOptions = document.getElementById('translate_options');
                                const sourceLang = document.getElementById('source_lang');
                                const targetLang = document.getElementById('target_lang');
                                const model = document.getElementById('model');
                                
                                translateOptions.style.display = needTranslate ? 'grid' : 'none';
                                sourceLang.required = needTranslate;
                                targetLang.required = needTranslate;
                                model.required = needTranslate;
                            }

                            // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
                            document.addEventListener('DOMContentLoaded', function() {
                                toggleTranslateOptions();
                            });
                        </script>

                        <button type="submit" 
                            class="w-full bg-blue-600 text-white py-3 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
                            å¼€å§‹å¤„ç†
                        </button>
                    </form>

                    <div id="loading" class="hidden mt-6 text-center text-gray-600">
                        <div class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-blue-600 border-t-transparent"></div>
                        <p class="mt-2">æ­£åœ¨å¤„ç†ä¸­...</p>
                    </div>

                    <div id="status" class="hidden mt-6 p-4 rounded-md"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('uploadForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const fileInput = document.getElementById('file');
            const needTranslate = document.getElementById('need_translate').checked;
            const outputFormat = document.getElementById('output_format').value;
            
            // éªŒè¯æ–‡ä»¶
            if (!fileInput.files || fileInput.files.length === 0) {
                alert('è¯·é€‰æ‹©è¦å¤„ç†çš„æ–‡ä»¶');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            formData.append('output_format', outputFormat);
            formData.append('need_translate', String(needTranslate));  // è½¬æ¢ä¸ºå­—ç¬¦ä¸²
            
            // æ·»åŠ ç¿»è¯‘ç›¸å…³çš„å‚æ•°ï¼Œå¦‚æœä¸éœ€è¦ç¿»è¯‘åˆ™ä½¿ç”¨ç©ºå­—ç¬¦ä¸²
            const sourceLang = needTranslate ? document.getElementById('source_lang').value : '';
            const targetLang = needTranslate ? document.getElementById('target_lang').value : '';
            const model = needTranslate ? document.getElementById('model').value : '';
            
            formData.append('source_lang', sourceLang);
            formData.append('target_lang', targetLang);
            formData.append('model', model);
            
            const loading = document.getElementById('loading');
            const status = document.getElementById('status');
            
            loading.classList.remove('hidden');
            status.classList.add('hidden');
            
            try {
                const response = await fetch('/translate-file', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('Response error:', {
                        status: response.status,
                        statusText: response.statusText,
                        error: errorData
                    });
                    throw new Error(errorData.detail || 'å¤„ç†å¤±è´¥');
                }
                
                const result = await response.json();
                console.log('Success response:', result);
                
                status.textContent = 'å¤„ç†æˆåŠŸï¼æ­£åœ¨å‡†å¤‡ä¸‹è½½...';
                status.classList.remove('hidden');
                status.className = 'mt-6 p-4 rounded-md bg-green-100 text-green-800';
                
                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const downloadUrl = `/download/${result.filename}`;
                const downloadLink = document.createElement('a');
                downloadLink.href = downloadUrl;
                downloadLink.className = 'block mt-4 text-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700';
                downloadLink.textContent = 'ä¸‹è½½å¤„ç†åçš„æ–‡ä»¶';
                status.appendChild(downloadLink);
            } catch (error) {
                console.error('å¤„ç†é”™è¯¯:', error);
                status.textContent = error.message || 'ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•';
                status.classList.remove('hidden');
                status.className = 'mt-6 p-4 rounded-md bg-red-100 text-red-800';
            } finally {
                loading.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
